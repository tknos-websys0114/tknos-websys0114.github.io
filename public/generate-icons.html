<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”ŸæˆPWAå›¾æ ‡</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .instructions {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            line-height: 1.6;
        }
        .preview-container {
            display: flex;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        .preview {
            text-align: center;
        }
        canvas {
            border: 1px solid #ddd;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .size-label {
            margin-top: 10px;
            color: #666;
            font-weight: 500;
        }
        button {
            background: #007aff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            transition: background 0.2s;
        }
        button:hover {
            background: #0051d5;
        }
        button:active {
            transform: scale(0.98);
        }
        .success {
            background: #34c759;
            padding: 15px;
            border-radius: 6px;
            color: white;
            margin: 20px 0;
            display: none;
        }
        .file-input-container {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            text-align: center;
        }
        input[type="file"] {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± ç”Ÿæˆ Touken OS PWA å›¾æ ‡</h1>
        
        <div class="instructions">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
            1. ç‚¹å‡»"é€‰æ‹©å›¾ç‰‡"æŒ‰é’®ï¼Œé€‰æ‹©æä¾›çš„çŒ«å¤´å›¾æ ‡<br>
            2. é¢„è§ˆç”Ÿæˆçš„192x192å’Œ512x512å›¾æ ‡<br>
            3. ç‚¹å‡»ä¸‹è½½æŒ‰é’®ä¿å­˜å›¾æ ‡åˆ°/publicç›®å½•<br>
            4. å°†ä¸‹è½½çš„icon-192.pngå’Œicon-512.pngæ”¾å…¥é¡¹ç›®çš„/publicç›®å½•<br>
            5. éƒ¨ç½²åˆ°HTTPSæœåŠ¡å™¨å³å¯ä½¿ç”¨PWAåŠŸèƒ½
        </div>

        <div class="file-input-container">
            <label for="imageInput">
                <strong>é€‰æ‹©å›¾æ ‡å›¾ç‰‡ï¼š</strong>
            </label><br>
            <input type="file" id="imageInput" accept="image/*">
        </div>

        <div class="preview-container">
            <div class="preview">
                <canvas id="canvas192" width="192" height="192"></canvas>
                <div class="size-label">192 Ã— 192</div>
                <button onclick="downloadIcon(192)">ä¸‹è½½ 192Ã—192</button>
            </div>
            <div class="preview">
                <canvas id="canvas512" width="512" height="512"></canvas>
                <div class="size-label">512 Ã— 512</div>
                <button onclick="downloadIcon(512)">ä¸‹è½½ 512Ã—512</button>
            </div>
        </div>

        <button onclick="downloadAll()" style="background: #34c759; font-weight: 600;">ğŸ“¦ ä¸‹è½½æ‰€æœ‰å›¾æ ‡</button>

        <div id="success" class="success">
            âœ“ å›¾æ ‡å·²ç”Ÿæˆï¼è¯·ä¸‹è½½å¹¶æ”¾å…¥ /public ç›®å½•
        </div>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        let sourceImage = null;

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        sourceImage = img;
                        generateIcons();
                        document.getElementById('success').style.display = 'block';
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        function generateIcons() {
            if (!sourceImage) return;

            // ç”Ÿæˆ 192x192
            generateIcon(192);
            // ç”Ÿæˆ 512x512
            generateIcon(512);
        }

        function generateIcon(size) {
            const canvas = document.getElementById(`canvas${size}`);
            const ctx = canvas.getContext('2d');
            
            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, size, size);
            
            // ç»˜åˆ¶ç™½è‰²èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, size, size);
            
            // è®¡ç®—å›¾ç‰‡ç»˜åˆ¶å°ºå¯¸ï¼ˆä¿æŒå±…ä¸­ï¼Œç•™ä¸€ç‚¹è¾¹è·ï¼‰
            const padding = size * 0.05; // 5% è¾¹è·
            const imageSize = size - (padding * 2);
            
            // ç»˜åˆ¶å›¾ç‰‡ï¼ˆå±…ä¸­ï¼‰
            ctx.drawImage(
                sourceImage,
                padding,
                padding,
                imageSize,
                imageSize
            );
        }

        function downloadIcon(size) {
            if (!sourceImage) {
                alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡ï¼');
                return;
            }

            const canvas = document.getElementById(`canvas${size}`);
            canvas.toBlob(function(blob) {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `icon-${size}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        function downloadAll() {
            if (!sourceImage) {
                alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡ï¼');
                return;
            }

            setTimeout(() => downloadIcon(192), 100);
            setTimeout(() => downloadIcon(512), 300);
        }
    </script>
</body>
</html>
